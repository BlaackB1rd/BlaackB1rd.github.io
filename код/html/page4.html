<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–æ—Ä–∑–∏–Ω–∞ - Gym House</title>
    <link rel="stylesheet" href="/–∫–æ–¥/css/page4.css">
    <link rel="icon" href="/–ö–∞—Ç–∏–Ω–∫–∏/Logo.svg">
</head>
<body>

<header>
    <article class="container">
        <div class="container--logo">
            <img src="/–ö–∞—Ç–∏–Ω–∫–∏/Logo.svg" alt="" width="80">
            <a href="" class="logo">Gym <br> House</a>
        </div>
        <nav>
            <div class="burger">
                <span></span>
                <span></span>
                <span></span>
            </div>
            <div class="nav-menu">
                <ul class="header--list">
                    <li class="header--list--item"><a href="/–∫–æ–¥/html/page1.html">–ì–ª–∞–≤–Ω–∞—è</a></li>
                    <li class="header--list--item"><a href="/–∫–æ–¥/html/page2.html">–ö–∞—Ç–∞–ª–æ–≥</a></li>
                    <li class="header--list--item"><a href="/–∫–æ–¥/html/page3.html">–î–æ—Å—Ç–∞–≤–∫–∞ –∏ –æ–ø–ª–∞—Ç–∞</a></li>
                    <li class="header--list--item">
                        <a href="/–∫–æ–¥/html/page4.html" class="cart-icon">
                            –ö–æ—Ä–∑–∏–Ω–∞
                            <span class="cart-count">0</span>
                        </a>
                    </li>
                </ul>
            </div>
        </nav>
    </article>
</header>

<main>
    <div class="order-container">
        <h2 class="order-title">–û—Ñ–æ—Ä–º–ª–µ–Ω–∏–µ –∑–∞–∫–∞–∑–∞</h2>
        <div class="cart-content">
            
        </div>
        <form class="order-form">
            <div class="form-row">
                <div class="form-group">
                    <label class="required">–§–∞–º–∏–ª–∏—è:</label>
                    <input type="text" name="lastname" required>
                </div>
                <div class="form-group">
                    <label class="required">–ò–º—è:</label>
                    <input type="text" name="firstname" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label>–û—Ç—á–µ—Å—Ç–≤–æ:</label>
                    <input type="text" name="middlename">
                </div>
                <div class="form-group">
                    <label class="required">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    <input type="tel" name="phone" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="required">Email:</label>
                    <input type="email" name="email" required>
                </div>
                <div class="form-group">
                    <label class="required">–ì–æ—Ä–æ–¥:</label>
                    <input type="text" name="city" required>
                </div>
            </div>
            <div class="form-row">
                <div class="form-group">
                    <label class="required">–ò–Ω–¥–µ–∫—Å:</label>
                    <input type="text" name="postcode" required>
                </div>
                <div class="form-group">
                    <label class="required">–ê–¥—Ä–µ—Å:</label>
                    <input type="text" name="address" required>
                </div>
            </div>
            <div class="payment-method">
                <h3 class="section-title">–°–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã</h3>
                <div class="payment-options">
                    <label class="payment-option">
                        <input type="radio" name="payment" value="cash" checked>
                        <div class="option-content">
                            <div class="checkmark"></div>
                            <div class="option-text">
                                <div class="title">–ù–∞–ª–∏—á–Ω—ã–º–∏ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏</div>
                            </div>
                        </div>
                    </label>
                    <label class="payment-option">
                        <input type="radio" name="payment" value="card">
                        <div class="option-content">
                            <div class="checkmark"></div>
                            <div class="option-text">
                                <div class="title">–ë–∞–Ω–∫–æ–≤—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π –æ–Ω–ª–∞–π–Ω</div>
                            </div>
                        </div>
                    </label>
                </div>
            </div>
            <button type="submit" class="order-btn">–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑</button>
        </form>
    </div>
</main>

<footer>
    <article class="foot">
        <div class="data">
            <div class="container--logo">
                <img src="/–ö–∞—Ç–∏–Ω–∫–∏/Logo.svg" alt="" width="80">
                <a href="" class="logo">Gym <br> House</a> 
            </div>
        </div>
        <div class="data">
            <p>–û–û–û "–°–ø–æ—Ä—Ç—Å–µ—Ç—å" <br>
            –Æ—Ä–∏–¥–∏—á–µ—Å–∫–∏–π –∞–¥—Ä–µ—Å: <br>
            —É–ª –ü—É—à–∫–∏–Ω–∞, 52</p>
        </div>
        <div class="data">
            <div>
                <img src="/–ö–∞—Ç–∏–Ω–∫–∏/phone-call.png" class="dat">
                <p>+375 29 123 45 67</p>
            </div>
            <div>
                <img src="/–ö–∞—Ç–∏–Ω–∫–∏/mail.png" class="dat">
                <p>gymHouse@gmail.com</p>
            </div>
            <div>
                <img src="/–ö–∞—Ç–∏–Ω–∫–∏/clock.png" class="dat">
                <p>–ø–Ω-–ø—Ç 8.00-22.00</p>
            </div>
        </div>
    </article>
</footer>

<script>
// XML –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
const XMLHandler = {
    serialize(cart) {
        const xmlDoc = document.implementation.createDocument(null, "cart");
        const root = xmlDoc.documentElement;
        
        cart.forEach(item => {
            const itemElem = xmlDoc.createElement("item");
            itemElem.setAttribute("id", item.id);
            itemElem.setAttribute("name", item.name);
            itemElem.setAttribute("price", item.price);
            itemElem.setAttribute("image", item.image);
            itemElem.setAttribute("quantity", item.quantity);
            root.appendChild(itemElem);
        });
        
        return new XMLSerializer().serializeToString(xmlDoc);
    },

    deserialize(xmlString) {
        try {
            const parser = new DOMParser();
            const xmlDoc = parser.parseFromString(xmlString, "text/xml");
            const items = xmlDoc.getElementsByTagName("item");
            const cart = [];
            
            for(let item of items) {
                cart.push({
                    id: item.getAttribute("id"),
                    name: item.getAttribute("name"),
                    price: parseFloat(item.getAttribute("price")),
                    image: item.getAttribute("image"),
                    quantity: parseInt(item.getAttribute("quantity"))
                });
            }
            return cart;
        } catch(e) {
            console.error("XML Parse Error:", e);
            return [];
        }
    }
};

// –ú–µ–Ω–µ–¥–∂–µ—Ä –∫–æ—Ä–∑–∏–Ω—ã
const CartManager = {
    get() {
        const xmlData = localStorage.getItem("cart");
        return xmlData ? XMLHandler.deserialize(xmlData) : [];
    },

    update(cart) {
        localStorage.setItem("cart", XMLHandler.serialize(cart));
    },

    count() {
        return this.get().reduce((sum, item) => sum + item.quantity, 0);
    }
};

// –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
document.addEventListener('DOMContentLoaded', () => {
    let cart = CartManager.get();
    const updateInterface = () => {
        document.querySelector('.cart-count').textContent = CartManager.count();
        renderCart();
    };

    function formatPrice(price) {
        return price.toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, " ");
    }

    function renderCart() {
        const cartContent = document.querySelector('.cart-content');
        
        if (cart.length === 0) {
            cartContent.innerHTML = `
                <div class="empty-cart">
                    <div class="empty-icon">üõí</div>
                    <div class="empty-text">–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</div>
                    <a href="/–∫–æ–¥/html/page2.html" class="continue-btn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∫—É–ø–∫–∏</a>
                </div>`;
            return;
        }

        let html = `
            <div class="cart-items">
                <table class="order-table">
                    <thead>
                        <tr>
                            <th>–¢–æ–≤–∞—Ä</th>
                            <th>–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ</th>
                            <th>–¶–µ–Ω–∞</th>
                            <th>–°—É–º–º–∞</th>
                            <th></th>
                        </tr>
                    </thead>
                    <tbody>`;

        const total = cart.reduce((sum, item) => {
            const itemTotal = item.price * item.quantity;
            html += `
                <tr>
                    <td data-label="–¢–æ–≤–∞—Ä">
                        <div class="product-info">
                            <img src="${item.image}" alt="${item.name}" class="product-img">
                            <span>${item.name}</span>
                        </div>
                    </td>
                    <td data-label="–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ">
                        <div class="qty-controls">
                            <button class="qty-btn minus" data-id="${item.id}">-</button>
                            <span class="qty">${item.quantity}</span>
                            <button class="qty-btn plus" data-id="${item.id}">+</button>
                        </div>
                    </td>
                    <td data-label="–¶–µ–Ω–∞" class="price">${formatPrice(item.price)} —Ä—É–±.</td>
                    <td data-label="–°—É–º–º–∞" class="price">${formatPrice(itemTotal)} —Ä—É–±.</td>
                    <td>
                        <button class="remove-btn" data-id="${item.id}">√ó</button>
                    </td>
                </tr>`;
            return sum + itemTotal;
        }, 0);

        html += `</tbody></table>
                <div class="cart-summary">
                    <div class="summary-row">
                        <span class="label">–ò—Ç–æ–≥–æ:</span>
                        <span class="value">${formatPrice(total)} —Ä—É–±.</span>
                    </div>
                </div>
            </div>`;

        cartContent.innerHTML = html;

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        document.querySelectorAll('.qty-btn').forEach(btn => {
            btn.addEventListener('click', handleQuantity);
        });

        document.querySelectorAll('.remove-btn').forEach(btn => {
            btn.addEventListener('click', handleRemove);
        });
    }

    function handleQuantity(e) {
        const id = e.target.dataset.id;
        const isPlus = e.target.classList.contains('plus');
        
        cart = cart.map(item => {
            if(item.id === id) {
                item.quantity = isPlus ? 
                    item.quantity + 1 : 
                    Math.max(1, item.quantity - 1);
            }
            return item;
        }).filter(item => item.quantity > 0);
        
        CartManager.update(cart);
        updateInterface();
    }

    function handleRemove(e) {
        const id = e.target.dataset.id;
        cart = cart.filter(item => item.id !== id);
        CartManager.update(cart);
        updateInterface();
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞
    document.querySelector('.order-form').addEventListener('submit', function(e) {
        e.preventDefault();
        
        if (cart.length === 0) {
            alert('–í–∞—à–∞ –∫–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞!');
            return;
        }

        // –û—á–∏—Å—Ç–∫–∞ –∫–æ—Ä–∑–∏–Ω—ã
        cart = [];
        CartManager.update(cart);
        updateInterface();
        
        alert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ—Ñ–æ—Ä–º–ª–µ–Ω! –°–ø–∞—Å–∏–±–æ –∑–∞ –ø–æ–∫—É–ø–∫—É!');
        this.reset();
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    updateInterface();
});

// –§—É–Ω–∫—Ü–∏—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É (–¥–ª—è –¥—Ä—É–≥–∏—Ö —Å—Ç—Ä–∞–Ω–∏—Ü)
function addToCart(product) {
    const cart = CartManager.get();
    const existing = cart.find(item => item.id === product.id);

    if(existing) {
        existing.quantity += product.quantity || 1;
    } else {
        cart.push({
            ...product,
            quantity: product.quantity || 1
        });
    }

    CartManager.update(cart);
    
    // –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
    const notification = document.createElement('div');
    notification.className = 'cart-notification';
    notification.innerHTML = `
        <div class="notification-content">
            <span>–¢–æ–≤–∞—Ä "${product.name}" –¥–æ–±–∞–≤–ª–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω—É!</span>
            <a href="/–∫–æ–¥/html/page4.html">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</a>
        </div>`;
    
    document.body.appendChild(notification);
    setTimeout(() => notification.classList.add('show'), 10);
    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
    }, 3000);
}

// –ë—É—Ä–≥–µ—Ä-–º–µ–Ω—é
document.querySelector('.burger').addEventListener('click', function() {
    this.classList.toggle('active');
    document.querySelector('.nav-menu').classList.toggle('active');
    document.body.style.overflow = 
        document.body.style.overflow === 'hidden' ? '' : 'hidden';
});
</script>

</body>
</html>